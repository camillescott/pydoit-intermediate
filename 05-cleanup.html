<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="generator" content="pandoc">
    <title>Software Carpentry: Cleaning</title>
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="css/bootstrap/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="css/swc.css" />
    <link rel="alternate" type="application/rss+xml" title="Software Carpentry Blog" href="http://software-carpentry.org/feed.xml"/>
    <meta charset="UTF-8" />
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body class="lesson">
    <div class="container card">
  <div class="banner">
  </div>

      <div class="row">
        <div class="col-md-10 col-md-offset-1">
          <h1 class="title">Cleaning</h1>
          
<div id="learning-objectives" class="objectives panel panel-warning">
<div class="panel-heading">
<h2 id="learning-objectives" class="objectives panel panel-warning"><span class="glyphicon glyphicon-certificate"></span>Learning Objectives</h2>
</div>
<div class="panel-body">
<ul>
<li>Learn how to use the <code>clean</code> attribute.</li>
<li>Define a custom clean function.</li>
</ul>
</div>
</div>
<p>In the last section, we changed the heatmap plotting function and had to manually remove the target to have it regenerated. Wouldn't it be nice to not have to do that? Yes, yes it would!</p>
<p>The best way to accomplish this is via the <code>clean</code> attribute. As one might guess, the <code>clean</code> attribute should be a function which cleans up after the task. Conveniently, the project creator has included an extremely useful function for this, called <code>clean_targets</code>, which just goes ahead and <code>rm</code>'s the target for that task. Here's what it looks like included in our humble download task.</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python"><span class="im">from</span> doit.task include clean_targets

<span class="kw">def</span> task_download_data():
     <span class="cf">return</span> {<span class="st">&#39;actions&#39;</span>: [<span class="st">&#39;curl -OL https://s3.amazonaws.com/pydoit-intermediate/Melee_data.csv.gz&#39;</span>],
             <span class="co">&#39;targets&#39;</span>: [<span class="st">&#39;Melee_data.csv.gz&#39;</span>],
             <span class="co">&#39;uptodate&#39;</span>: [run_once],
             <span class="co">&#39;clean&#39;</span>: [clean_targets]}</code></pre></div>
<p>Now, if we run <code>doit clean</code>, the data file will be removed; if we run <code>doit</code>, all the tasks will be rerun, because they all depend directly or indirectly on the downloaded data file.</p>
<div id="cleaning-targets" class="callout panel panel-info">
<div class="panel-heading">
<h2 id="cleaning-targets" class="callout panel panel-info"><span class="glyphicon glyphicon-pushpin"></span>Cleaning targets</h2>
</div>
<div class="panel-body">
<p>Pydoit's creator clearly saw that removing the targets would be an extremely common task. As such, one does not actually need to import the <code>clean_targets</code> function; just passing <code>[True]</code> to <code>clean</code> will suffice. However, if you would like both remove the targets <em>and</em> do something else to revert your task, the list should include <code>clean_targets</code> and whatever other callable or string you'd like run.</p>
</div>
</div>
<p><code>clean</code> can also be a shell command or function that the user defines. For example, we might want to inform the user where the pipeline got the file they just blew away.</p>
<div class="sourceCode"><pre class="sourceCode python"><code class="sourceCode python">DATA_URL <span class="op">=</span> <span class="st">&#39;https://s3.amazonaws.com/pydoit-intermediate/Melee_data.csv.gz&#39;</span>

<span class="kw">def</span> task_download_data():

    <span class="kw">def</span> print_url():
        <span class="bu">print</span> <span class="st">&#39;File was retrieved from: </span><span class="sc">{0}</span><span class="st">&#39;</span>.<span class="bu">format</span>(DATA_URL)

    <span class="cf">return</span> {<span class="st">&#39;actions&#39;</span>: [<span class="st">&#39;curl -OL </span><span class="sc">{0}</span><span class="st">&#39;</span>.<span class="bu">format</span>(DATA_URL)],
             <span class="co">&#39;targets&#39;</span>: [<span class="st">&#39;Melee_data.csv.gz&#39;</span>],
             <span class="co">&#39;uptodate&#39;</span>: [run_once],
             <span class="co">&#39;clean&#39;</span>: [clean_targets, print_url]}</code></pre></div>
<p>The <code>clean</code> attribute takes the same form as <code>actions</code> or even <code>uptodate</code>, and so can also be a string to be executed in the shell.</p>
<div id="clean-all-the-things" class="challenge panel panel-success">
<div class="panel-heading">
<h2 id="clean-all-the-things" class="challenge panel panel-success"><span class="glyphicon glyphicon-pencil"></span>Clean all the things</h2>
</div>
<div class="panel-body">
<p>Add <code>clean</code> attributes to all the currently defined tasks. If you'd like, get creative with your attributes. Include two clean actions in at least one of the tasks (the second doesn't have to do anything groundbreaking).</p>
</div>
</div>
        </div>
      </div>
      <div class="footer">
        <a class="label swc-blue-bg" href="http://software-carpentry.org">Software Carpentry</a>
        <a class="label swc-blue-bg" href="https://github.com/swcarpentry/lesson-template">Source</a>
        <a class="label swc-blue-bg" href="camille.scott.w@gmail.com">Contact</a>
        <a class="label swc-blue-bg" href="LICENSE.html">License</a>
      </div>
    </div>
    <!-- Javascript placed at the end of the document so the pages load faster -->
    <script src="http://software-carpentry.org/v5/js/jquery-1.9.1.min.js"></script>
    <script src="css/bootstrap/bootstrap-js/bootstrap.js"></script>
  </body>
</html>
